---
title: "EDA on NYC Test Scores Data"
author: "Ransford Hyman Jr."
date: "December 15, 2015"
output: html_document
---

```{r global_options, include=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE,warning=FALSE,message=FALSE)
```

```{r Reshaping functions}
initial_reshape_function <- function(df,s){
  df <- subset(df, df$Grade != "All Grades")
  df$Grade <- as.character(df$Grade)
  df$Grade <- as.integer(df$Grade)
  df$Mean.Scale.Score <- as.numeric(df$Mean.Scale.Score)
  df$Level1Percentage <- as.numeric(df$Level1Percentage)
  df$Level2Percentage <- as.numeric(df$Level2Percentage)
  df$Level3Percentage <- as.numeric(df$Level3Percentage)
  df$Level4Percentage <- as.numeric(df$Level4Percentage)
  df$Subject <- s
  df$Category <- factor(df$Category)
  df$Subject <- factor(df$Subject)
  return(df)
}
```

##Analyzing Test Data on a Borough-level Granulatrity 2013-2015
```{r Reshaping All Students Data} 
setwd('C:\\Users\\ransf\\OneDrive\\Documents\\GitHub\\EDA-On-NYC-TestScores\\BoroughData')
df <- read.csv("BoroughELAResults20132015_ALL.csv")
df <- initial_reshape_function(df,"ELA")


df1 <- read.csv("BoroughELAResults20132015_Gender.csv")
df1 <- initial_reshape_function(df1, "ELA")


df2 <- read.csv("BoroughELAResults20132015_Ethnicity.csv")
df2 <- initial_reshape_function(df2, "ELA")

df3 <- read.csv("BoroughELAResults20132015_ELL.csv")
df3 <- initial_reshape_function(df3, "ELA")

library(dplyr)
ela.2013.2015 <- bind_rows(df,df1)
ela.2013.2015 <- bind_rows(ela.2013.2015,df2)
ela.2013.2015 <- bind_rows(ela.2013.2015,df3)

rm(df, df1, df2, df3)

df <- read.csv("BoroughMathResults20132015_ALL.csv")
df <- initial_reshape_function(df, "Math")


df1 <- read.csv("BoroughMathResults20132015_ELL.csv")
df1 <- initial_reshape_function(df1, "Math")

df2 <- read.csv("BoroughMathResults20132015_Ethnicity.csv")
df2 <- initial_reshape_function(df2, "Math")

df3 <- read.csv("BoroughMathResults20132015_Gender.csv")
df3 <- initial_reshape_function(df3, "Math")
```


```{r Combining Math Data}
math.2013.2015 <- bind_rows(df,df1)
math.2013.2015 <- bind_rows(math.2013.2015,df2)
math.2013.2015 <- bind_rows(math.2013.2015,df3)

borough_data <- bind_rows(ela.2013.2015,math.2013.2015)
rm(ela.2013.2015,math.2013.2015)
rm(df, df1, df2, df3)
```

I retrieved the datasets from the NYC Open Data Portal.  You can find the 
data-sets at various granularities [here](http://schools.nyc.gov/Accountability/data/TestResults/ELAandMathTestResults).  
To get things started, let's analyze the data across each 
Borough from 2013-2015.  Analyzing at the Borough level gives us a high level 
view before we do more in-depth analysis at the school level in the latter 
sections.

##Univariate Plots and Analysis
```{r, fig.height=12, fig.width=12}
library(scales)
library(ggplot2)
library(gridExtra)

p1 <- ggplot(subset(borough_data, Category == "All Students"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') + 
  ggtitle("Distribution of Students Testing at Level 1")

p2 <- ggplot(subset(borough_data, Category == "All Students"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Students Testing at Level 2")

p3 <- ggplot(subset(borough_data, Category == "All Students"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Students Testing at Level 3")

p4 <- ggplot(subset(borough_data, Category == "All Students"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Students Testing at Level 4")

grid.arrange(p1,p2,p3,p4, ncol=2)
```

The percentage seems to peak around 27% for Level 1 students, around 36% 
for Level 2 students, around 23% for Level 3 students, and 7% for Level 4 
students.  All the distributions seem to be roughly normal, especially for the 
Level 1, 2, and 3 percentages.

```{r FreqPoly Plots, echo=FALSE, fig.height=12}

p1 <- ggplot(subset(borough_data,Category ==
                      c("Female","Male")),
             aes(Mean.Scale.Score,y=..count../sum(..count..))) +
  geom_freqpoly(aes(color=Category),binwidth=1) +  
  scale_y_continuous(labels = percent)

p2 <- ggplot(subset(borough_data,Category %in% 
                      c("Black", "White", "Hispanic", "Asian")),
             aes(Mean.Scale.Score,y=..count../sum(..count..))) +
  geom_freqpoly(aes(color=Category), binwidth = 1) + 
  scale_y_continuous(labels = percent)

p3 <- ggplot(subset(borough_data,Category %in% 
                      c("ELL", "Former ELL", "EP") ),
             aes(Mean.Scale.Score,y=..count../sum(..count..))) +
  geom_freqpoly(aes(color=Category), binwidth = 1) +
  scale_y_continuous(labels = percent)


grid.arrange(p1, p2, p3, ncol=1)
```


It looks like females' mean score begin to overtake males' mean score around 
303.  Males peak at around 297 while females peak around 307. Females minimum 
mean score seems to fall around 283. Whites and Asians' mean scores begin to 
become a higher proportion of their students around 310  where it begins to 
peak and slowly decreases as the mean score amount get increases.  A large 
proportion of Black and Hispanics' mean scores fall between 280 and 300. Black 
Students' mean score maxes out around 295. Hispanic Students' mean score maxes 
out around 305. EP students seem to peak around the same mean score as females 
do.  ELL students are somewhat evenly spread between the mean scores' 250 and 
290.  There seems to be no representation of ELL students past 292.

Since most of the variables within the dataset are categorical variables,
Let's analyze how the plots over gender, and race.  First we generate the 
histograms for each level for females.

```{r, fig.height=12, fig.width=12}

p1 <- ggplot(subset(borough_data, Category == "Female"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Female Students Testing at Level 1")

p2 <- ggplot(subset(borough_data, Category == "Female"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Female Students Testing at Level 2")

p3 <- ggplot(subset(borough_data, Category == "Female"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Female Students Testing at Level 3")

p4 <- ggplot(subset(borough_data, Category == "Female"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Female Students Testing at Level 4")

grid.arrange(p1,p2,p3,p4, ncol=2)

```

Each level seems to have somewhat of a normal distribution with the mean value
 being around 25% for level 1, 36% for level 2, 22% for level 3, and 12% for 
 level 4.  Let us perform some summary statistics to see if the mean and median 
 values indicate a normal distribution. 
```{r}
with(subset(borough_data, Category == "Female"), 
     summary(borough_data$Level1Percentage))
with(subset(borough_data, Category == "Female"), 
     summary(borough_data$Level2Percentage))
with(subset(borough_data, Category == "Female"), 
     summary(borough_data$Level3Percentage))
with(subset(borough_data, Category == "Female"), 
     summary(borough_data$Level4Percentage))
```
 
The summary statistics do indeed show a normal distribution.  My estimates for 
the level 3 and level 4 mean values were fairly close to the exact values as 
well.  Let's look at histograms for males across the different levels.

```{r, fig.height=12, fig.width=12}

p1 <- ggplot(subset(borough_data, Category == "Male"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Male Students Testing at Level 1")

p2 <- ggplot(subset(borough_data, Category == "Male"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Male Students Testing at Level 2")

p3 <- ggplot(subset(borough_data, Category == "Male"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Male Students Testing at Level 3")

p4 <- ggplot(subset(borough_data, Category == "Male"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Male Students Testing at Level 4")

grid.arrange(p1,p2,p3,p4, ncol=2)

```

The distributions are roughly the same as the female distributions.  Let us see
if the summary statistics tell a different story.
```{r}
with(subset(borough_data, Category == "Male"), 
     summary(borough_data$Level1Percentage))
with(subset(borough_data, Category == "Male"), 
     summary(borough_data$Level2Percentage))
with(subset(borough_data, Category == "Male"), 
     summary(borough_data$Level3Percentage))
with(subset(borough_data, Category == "Male"), 
     summary(borough_data$Level4Percentage))
```

The summary statistics seem to agree with my inference. Let's look at histograms 
by race starting with African Americans.
```{r, fig.height=12, fig.width=12}

p1 <- ggplot(subset(borough_data, Category == "Black"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Black Students Testing at Level 1")

p2 <- ggplot(subset(borough_data, Category == "Black"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Black Students Testing at Level 2")

p3 <- ggplot(subset(borough_data, Category == "Black"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Black Students Testing at Level 3")

p4 <- ggplot(subset(borough_data, Category == "Black"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Black Students Testing at Level 4")

grid.arrange(p1,p2,p3,p4, ncol=2)

```

We can see that there are high counts of observations in the level 1 and 2 plots
where the mean is almost 50% for African Americans in level 1.Let's see how the 
data for Hispanics looks like.
```{r, fig.height=12, fig.width=12}

p1 <- ggplot(subset(borough_data, Category == "Hispanic"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Hispanic Students Testing at Level 1")

p2 <- ggplot(subset(borough_data, Category == "Hispanic"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Hispanic Students Testing at Level 2")

p3 <- ggplot(subset(borough_data, Category == "Hispanic"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Hispanic Students Testing at Level 3")

p4 <- ggplot(subset(borough_data, Category == "Hispanic"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Hispanic Students Testing at Level 4")

grid.arrange(p1,p2,p3,p4, ncol=2)

```

The plots are very similar to those of African Americans.  Let's look at 
histograms for White students
```{r, fig.height=12, fig.width=12}

p1 <- ggplot(subset(borough_data, Category == "White"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of White Students Testing at Level 1")

p2 <- ggplot(subset(borough_data, Category == "White"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of White Students Testing at Level 2")

p3 <- ggplot(subset(borough_data, Category == "White"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of White Students Testing at Level 3")

p4 <- ggplot(subset(borough_data, Category == "White"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of White Students Testing at Level 4")

grid.arrange(p1,p2,p3,p4, ncol=2)

```

There is a noticable decrease in the distribution of White students who fall in 
the level 1 and 2 category and a larger distribution of level 3 and 4 students.
Finally, we look at histograms for Asian students
```{r, fig.height=12, fig.width=12}

p1 <- ggplot(subset(borough_data, Category == "Asian"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Asian Students Testing at Level 1")

p2 <- ggplot(subset(borough_data, Category == "Asian"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Asian Students Testing at Level 2")

p3 <- ggplot(subset(borough_data, Category == "Asian"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Asian Students Testing at Level 3")

p4 <- ggplot(subset(borough_data, Category == "Asian"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Asian Students Testing at Level 4")

grid.arrange(p1,p2,p3,p4, ncol=2)

```

Asian students have a much lower distribution in the level 1 category, but their
level 2 and 3 distributions are roughly equivalent to those of white students.
Where Asian students really stand out is in the level 4 category where there 
are observations where 60% of the Asian students were in the level 4 category.

##Bivariate Analysis and Plots
```{r Analyzing Borough Data, echo=FALSE}
library(ggplot2)

ggplot(subset(borough_data,Category == "All Students" ), 
       aes(y=Mean.Scale.Score,x=Borough)) + geom_boxplot() + 
  ylab("Mean Score for All students and both Subjects")
```

It looks like Queens has the highest Median mean scores across all the boroughs.
Now we want to analyze scores for each subject for all students:
```{r fig.width= 12}
library(gridExtra)
p1 <- ggplot(subset(borough_data,Category == "All Students" & 
                      Subject == "ELA"), aes(Borough,Mean.Scale.Score)) + 
  geom_boxplot() +  ylab("Mean Score for All students in ELA")


p2 <- ggplot(subset(borough_data,Category == "All Students" & 
                      Subject == "Math"), aes(Borough,Mean.Scale.Score)) + 
  geom_boxplot() +  
  ylab("Mean Score for All students in Math")

grid.arrange(p1,p2,ncol=2)
```

From the plots, The Bronx has significantly lower test scores then the other 
boroughs.  Staten Island has the highest median mean score in ELA while Queens 
has the highest median mean score in Mathematics.  We now have a look at the 
scores by Gender across all boroughs.


```{r fig.width=12}
p1 <- ggplot(subset(borough_data,Category == c("Female", "Male")), 
       aes(Category,Mean.Scale.Score)) + geom_boxplot() +  
  ylab("Mean Score for All students")

p2 <- ggplot(subset(borough_data,Category == 
                      c("Female", "Male") & Subject == "ELA"),
             aes(Category,Mean.Scale.Score)) + geom_boxplot() + 
  ylab("Mean Score for All students in ELA")

grid.arrange(p1,p2,ncol=2)
```

```{r}
ggplot(subset(borough_data,Category == c("Female", "Male") & 
                Subject == "Math"),
       aes(Category,Mean.Scale.Score)) + 
  geom_boxplot() +  ylab("Mean Score for All students in Math")

```


The plots show that Females outperform the males in both Math and ELA.  The 
difference in median scores between males and females appears to be significant, 
in particular in the ELA and the overall performance. Now let's look at the 
breakdown by race across all boroughs.

```{r Boxplots categorized by race, echo=FALSE}
ggplot(subset(borough_data,Category %in% 
                c("Black", "White", "Hispanic", "Asian")), 
       aes(Category,Mean.Scale.Score)) + 
  geom_boxplot() +  ylab("Mean Score for All students")
```


```{r fig.width=12}
 p1 <- ggplot(subset(borough_data,Category %in% 
                c("Black", "White", "Hispanic", "Asian") & Subject == "ELA"),
       aes(Category,Mean.Scale.Score)) + 
  geom_boxplot() +  ylab("Mean Score for All students in ELA")

p2 <- ggplot(subset(borough_data,Category %in% 
                c("Black", "White", "Hispanic", "Asian") & Subject == "Math"),
       aes(Category,Mean.Scale.Score)) + geom_boxplot() + 
  ylab("Mean Score for All students in Math")
grid.arrange(p1,p2,ncol=2)
```

The data shows that Asian students outperform all other races in all 
categories.  The median score for Asian students is at least 10 points higher 
than all other races.  It seems that Black and Hispanic students are having 
significantly lower test scores than other races.  Next we will look at the 
breakdown based on English speaking students and English Language learning 
students.


```{r Boxplots categorized by Language Prefs}
ggplot(subset(borough_data,Category %in% c("ELL", "Former ELL", "EP") ),
       aes(Category,Mean.Scale.Score)) + 
  geom_boxplot() +  ylab("Mean Score for All Students")

```

```{r fig.width=12}
p1 <- ggplot(subset(borough_data,Category %in% 
                c("ELL", "Former ELL", "EP") & Subject == "ELA"),
       aes(Category,Mean.Scale.Score)) + geom_boxplot() +  
  ylab("Mean Score for All students in ELA")

p2 <- ggplot(subset(borough_data,Category %in% 
                c("ELL", "Former ELL", "EP") & Subject == "Math"),
       aes(Category,Mean.Scale.Score)) + geom_boxplot() +  
  ylab("Mean Score for All students in Math")
grid.arrange(p1,p2,ncol=2)
```

The data shows that English proficient students had the highest median scores 
which is expected.  Given the data, it seems that the barrier of not speaking 
English is reflective on the test scores outcome.  Former English Language 
Learners seem to do almost as good as English Proficient students.

```{r fig.width=12, fig.height=10}
p1 <- ggplot(borough_data, aes(Borough,Level1Percentage)) + 
  geom_boxplot() +  ylab("Percentage of Level 1 Students")

p2 <- ggplot(borough_data, aes(Borough,Level2Percentage)) + 
  geom_boxplot() + ylab("Percentage of Level 2 Students")

p3 <- ggplot(borough_data, aes(Borough,Level3Percentage)) + 
  geom_boxplot() + ylab("Percentage of Level 3 Students")

p4 <- ggplot(borough_data, aes(Borough,Level4Percentage)) + 
  geom_boxplot() + ylab("Percentage of Level 4 Students")

grid.arrange(p1,p2,p3,p4,ncol=2)
```


I found it interesting that although Queens has relatively the same proportion 
of Level 2,3, and 4 students, they had the highest median of mean value scores 
across all the boroughs. 

```{r fig.width=12, fig.height=10}
p1 <- ggplot(subset(borough_data,Category == c("Female", "Male")), 
       aes(Category,Level1Percentage)) + 
  geom_boxplot() +  ylab("Percentage of Level 1 Students")

p2 <- ggplot(subset(borough_data,Category == c("Female", "Male")), 
       aes(Category,Level2Percentage)) + 
  geom_boxplot() + ylab("Percentage of Level 2 Students")

p3 <-  ggplot(subset(borough_data,Category == c("Female", "Male")),
        aes(Category,Level3Percentage)) + 
  geom_boxplot() + ylab("Percentage of Level 3 Students")

p4 <- ggplot(subset(borough_data,Category == c("Female", "Male")), 
       aes(Category,Level4Percentage)) + 
  geom_boxplot() + ylab("Percentage of Level 4 Students")
grid.arrange(p1,p2,p3,p4,ncol=2)
```

It seems that Females had a lower proportion of Level 1 students and a higher 
proportion of level 2, 3, and 4 students than males.

```{r fig.width=12, fig.height=10}
p1 <- ggplot(subset(borough_data,Category %in% 
                c("Black", "White", "Hispanic", "Asian")), 
       aes(Category,Level1Percentage)) + 
  geom_boxplot() +  ylab(" Percentage of Level 1 Students")

p2 <-  ggplot(subset(borough_data,Category %in% 
                 c("Black", "White", "Hispanic", "Asian")), 
        aes(Category,Level2Percentage)) + 
  geom_boxplot() +  ylab(" Percentage of Level 2 Students")

p3 <-  ggplot(subset(borough_data,Category %in% 
                 c("Black", "White", "Hispanic", "Asian")), 
        aes(Category,Level3Percentage)) + 
  geom_boxplot() +  ylab(" Percentage of Level 3 Students")

p4 <- ggplot(subset(borough_data,Category %in% 
                c("Black", "White", "Hispanic", "Asian")), 
       aes(Category,Level4Percentage)) + 
  geom_boxplot() +  ylab(" Percentage of Level 4 Students")
grid.arrange(p1,p2,p3,p4,ncol=2)
```

 Black students had very large number of Level 1 and 2 students with almost 
 50% of them Level 1.  Asian students had the lowest median proportion of level 
 1 and 2 students and the highest median proportion of level 3 and 4 
 students.  White students had a lower median proportion of level 1 and 2 
 students in respect to Black and Hispanic students, but had a relatively equal 
 proportion of students at all levels compare to Asian students.



#Analyzing Test Data on a School-level Granulatrity 2006-2015
```{r Reshaping School Data functions}
## A separate function for school data was created because the column formats 
##are different 
##than the column formats in the borough data.  In the school data we need to 
##convert the 
##Percentage columns from "factors" to "characters" first and then convert them 
##to numerics. ##This was done because when converting from "factors" to 
##"numerics", we do not get the same ##initial decimal value.  All observations 
##that have 5 or less students tested have "s" 
##values for each column value so we filter those out.
initial_reshape_school_data <- function(df,s){
  df <- subset(df, df$Grade != "All Grades")
  df$Grade <- as.character(df$Grade)
  df$Grade <- as.integer(df$Grade)
  df <- subset(df, Number.Tested > 5)
  df$Number.Tested <- as.integer(df$Number.Tested)
  df$Level1Percentage <- as.character(df$Level1Percentage)
  df$Level2Percentage <- as.character(df$Level2Percentage)
  df$Level3Percentage <- as.character(df$Level3Percentage)
  df$Level4Percentage <- as.character(df$Level4Percentage)
  
  df$Mean.Scale.Score <- as.character(df$Mean.Scale.Score)
  df$Mean.Scale.Score <- as.integer(df$Mean.Scale.Score)
  df$Level1Percentage <- as.numeric(df$Level1Percentage)
  df$Level2Percentage <- as.numeric(df$Level2Percentage)
  df$Level3Percentage <- as.numeric(df$Level3Percentage)
  df$Level4Percentage <- as.numeric(df$Level4Percentage)
  df$Subject <- s
  return(df)
}
```


```{r}
setwd('C:\\Users\\ransf\\OneDrive\\Documents\\GitHub\\EDA-On-NYC-TestScores\\SchoolData')
df <- read.csv("SchoolMathResults20132015_ALL.csv")
df <- initial_reshape_school_data(df,"Math")


df1 <- read.csv("SchoolMathResults20132015_ELL.csv")
df1 <- initial_reshape_school_data(df1,"Math")

df2 <- read.csv("SchoolMathResults20132015_Ethnicity.csv")
df2 <- initial_reshape_school_data(df2,"Math")

df3 <- read.csv("SchoolMathResults20132015_Gender.csv")
df3 <- initial_reshape_school_data(df3,"Math")


math.2013.2015.school <- bind_rows(df,df1)
math.2013.2015.school <- bind_rows(math.2013.2015.school,df2)
math.2013.2015.school <- bind_rows(math.2013.2015.school,df3)

rm(df,df1,df2,df3)


df <- read.csv("SchoolELAResults20132015_ALL.csv")
df <- initial_reshape_school_data(df,"ELA")

df1 <- read.csv("SchoolELAResults20132015_ELL.csv")
df1 <- initial_reshape_school_data(df1,"ELA")

df2 <- read.csv("SchoolELAResults20132015_Ethnicity.csv")
df2 <- initial_reshape_school_data(df2,"ELA")
df3 <- read.csv("SchoolELAResults20132015_Gender.csv")
df3 <- initial_reshape_school_data(df3,"ELA")
```

```{r}
ela.2013.2015.school <- bind_rows(df,df1)
ela.2013.2015.school <- bind_rows(ela.2013.2015.school,df2)
ela.2013.2015.school <- bind_rows(ela.2013.2015.school,df3)

school_data.2013.2015 <- bind_rows(math.2013.2015.school,ela.2013.2015.school)
rm(math.2013.2015.school,ela.2013.2015.school)
```

##Univariate Analysis on School-Level Data 2013-2015
```{r}
## We extract the Borough information by analyzing the DBN for each school.
## If the DBN number has a specific character, then we assign it the 
##appropriate Borough
create_borough_vector <- function (v){
  
  cond <- grepl(".+M.+",v$DBN,perl = TRUE)
  v$Borough <- ifelse(cond,"Manhattan","Other Borough")
  cond <- grepl(".+X.+",v$DBN,perl = TRUE)
  v$Borough <- ifelse(cond,"Bronx",v$Borough)
   cond <- grepl(".+K.+",v$DBN,perl = TRUE)
  v$Borough <- ifelse(cond,"Brooklyn",v$Borough)
   cond <- grepl(".+Q.+",v$DBN,perl = TRUE)
  v$Borough <- ifelse(cond,"Queens",v$Borough)
   cond <- grepl(".+R.+",v$DBN,perl = TRUE)
  v$Borough <- ifelse(cond,"Staten Island",v$Borough)
  return(v)
}
```



```{r}
school_data.2013.2015 <- create_borough_vector(school_data.2013.2015)

```

Now that have analyzed the data at the borough level, let's have a look at the 
breakdown of the various levels given the data at the school level. We start 
with the data from 2013-2015 initially.

```{r,fig.height=12, fig.width=12}

p1 <- ggplot(subset(school_data.2013.2015, Category == "All Students"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Students Testing at Level 1")

p2 <- ggplot(subset(school_data.2013.2015, Category == "All Students"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Students Testing at Level 2")

p3 <- ggplot(subset(school_data.2013.2015, Category == "All Students"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Students Testing at Level 3")

p4 <- ggplot(subset(school_data.2013.2015, Category == "All Students"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Students Testing at Level 4")

grid.arrange(p1,p2,p3,p4, ncol=2)
```

Level 1 distribution is fairly uniform between 25-50% and tapers off afterwards.
It still has somewhat of a uniform distribution.  Level 2 distribution is normal
with the median value around 37%.  The level 3 distribution median's value seems
to falls around 13% it seems.  The level 4 distribution is long-tailed.  To get
a better view, we transform the histogram to use the log scale.  

```{r}
ggplot(subset(school_data.2013.2015, Category == "All Students"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') + scale_y_log10() +
  ggtitle("Distribution of Students Testing at Level 4 on Log scale")
```

Although the largest portion of schools have 0% of students who tested at level 
4, there are still some good portion of other schools that had a substiantial
percentage of their students who tested at level 4 as well.  It is a lot easier
to see the actual distribution with the log scale.  For all the other histograms
, we generate the level 4 percentage histograms with the log scale 
transformation. Nex we look at histograms for Females:

```{r,fig.height=12, fig.width=12}

p1 <- ggplot(subset(school_data.2013.2015, Category == "Female"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Female Students Testing at Level 1")

p2 <- ggplot(subset(school_data.2013.2015, Category == "Female"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Female Students Testing at Level 2")

p3 <- ggplot(subset(school_data.2013.2015, Category == "Female"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Female Students Testing at Level 3")

p4 <- ggplot(subset(school_data.2013.2015, Category == "Female"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black')+ scale_y_log10() +
  ggtitle("Distribution of Female Students Testing at Level 4 (Log scale)")

grid.arrange(p1,p2,p3,p4, ncol=2)
```

The distributions for the females are roughly the same as the distributions 
for all students.  There are a large number of 0% entries for levels 1 and 3.
Let's look at histograms for Males:

```{r, fig.height=12, fig.width=12}

p1 <- ggplot(subset(school_data.2013.2015, Category == "Male"), 
             aes(x = Level1Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Male Students Testing at Level 1")

p2 <- ggplot(subset(school_data.2013.2015, Category == "Male"), 
             aes(x = Level2Percentage)) + 
  geom_histogram(fill='white', binwidth = 1, color = 'black') +
  ggtitle("Distribution of Male Students Testing at Level 2")

p3 <- ggplot(subset(school_data.2013.2015, Category == "Male"), 
             aes(x = Level3Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black') +
  ggtitle("Distribution of Male Students Testing at Level 3")

p4 <- ggplot(subset(school_data.2013.2015, Category == "Male"), 
             aes(x = Level4Percentage)) + 
  geom_histogram(fill='white', binwidth=1, color = 'black')+ scale_y_log10() +
  ggtitle("Distribution of Male Students Testing at Level 4 (Log scale)")

grid.arrange(p1,p2,p3,p4, ncol=2)

```

The distributions are the roughly the same as females.  There is not much 
different insight than what was shown in the borugh univariate analysis; 
the data is just more fine-grained.  Let's see what the data tells us from the 
bivariate analysis.



##Bivariate Analysis on School-Level Data 2013-2015
I thought that it would be good to add a field for which borough the school 
resides in so I wrote a function to perform that action.  This is done based 
on the letter in the DBN number for the school:  "M" is for Manhattan, "K" is 
for Brooklyn, "X" is for the Bronx, "Q" is for Queens, and "R" is for Staten 
Island.



Since the percentage of level 1,2,3,4 students is the only continuous value 
field that is in this dataset, I thought it would be fitting for Bivariate 
Analysis.  The first plot is the Mean Score vs. Level1Percentage.


```{r geom_point_plot_1, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
ggplot(school_data.2013.2015, aes(x = Level1Percentage, y = Mean.Scale.Score)) + 
  geom_point()
```


Since there is a lot of over plotting, we use the alpha parameter to reduce it.


```{r geom_point_plot_2, cache=TRUE,cache.path= 'cache/',fig.path='figure/',fig.height = 12, fig.width =14}
p1 <- ggplot(school_data.2013.2015, aes(x = Level1Percentage, 
                                        y = Mean.Scale.Score)) + 
  geom_point(alpha = 1/25) + geom_smooth(method = 'lm', color= 'red')


p2 <- ggplot(school_data.2013.2015, aes(x = Level2Percentage, 
                                        y = Mean.Scale.Score)) + 
  geom_point(alpha = 1/25)+  geom_smooth(method = 'lm', color= 'red')

p3 <- ggplot(school_data.2013.2015, aes(x = Level3Percentage, 
                                        y = Mean.Scale.Score)) + 
  geom_point(alpha = 1/25)+  geom_smooth(method = 'lm', color= 'red')

p4 <- ggplot(school_data.2013.2015, aes(x = Level4Percentage, 
                                        y = Mean.Scale.Score)) + 
  geom_point(alpha = 1/25)+  geom_smooth(method = 'lm', color= 'red')

grid.arrange(p1,p2,p3,p4,ncol=2)
```

Looking at the Level 1 Percentage plot, we see some interesting trends at the 
extremes (0 percent and 100 percent).  Schools that tested 0 percent of Level 1 
students had a mean score range from 300 to 375 whereas schools that tested 100 
percent of Level 1 students had a mean score range from 225 to 275.  Most 
schools have Level 1 students within the range of 0 and 70 percent.  There seems
to be a strong linear relationship with the number of Level 1 students tested 
and mean score for the schools in the NYC area.

The plot for the Mean Score vs. Level 2 percentage is pretty interesting.  It 
generates an arrow-shaped plot.  There is huge variation in the range of Mean 
scores for schools who tested students with a Level 2 Percentage of 25 or less. 
After the 25 percent threshold, the mean scores for schools seems to converge 
to 300.

The plot for the Mean Score vs. Level 3 percentage shows a closer linear 
relationship.  Most schools tested students with Level 3 percentages in the 
range of 3 to about 35 percent.  The mean scores within this range fall mostly 
between 275 and 325.  After the 35 percent threshold, the mean scores continue 
to rise but the number of schools with higher percentages of Level 3 students 
slowly diminishes.

Most schools have students with Level 4 between 1 and 25 percent.  Even at low 
number of Level 4 percentages, most mean scores are above 300.  We see that the 
number of Level 4 students slowly diminishes after 25 percent but the mean 
scores steadily increases reaching mean scores as high as 380.

Now that we have a good field for the data for the past two years, lets wrangle 
the older data and combine it with the most recent data to see if we can see any
trends.  While looking at the data from 2006-2012, I noticed that the mean 
scores were higher in the older data than in the 2013-2015 Data.  After doing 
some searching on the web, I found this 
[site](http://www.p12.nysed.gov/irs/ela-math/).  The documents here show that 
the score scales vary year over year, so using the mean scale score will not be 
very useful when combining data from 2006-2012 with data from 2013-2015. The 
site also discusses what it means to test at specific levels.  Students that 
test at level 1 are well below the proficient standards in their grade.  Students 
that test at level 2 are partially proficient in their grade.  Students that 
test at level 3 are proficient at their grade, and students that test at level
4 excel above the proficient standards. 

```{r}
setwd('C:\\Users\\ransf\\OneDrive\\Documents\\GitHub\\EDA-On-NYC-TestScores\\SchoolData')
df1 <- read.csv("SchoolELAResults20062012Public_ALL.csv")
df1 <- initial_reshape_school_data(df1, "ELA")

df2 <- read.csv("SchoolELAResults20062012Public_ELL.csv")
df2 <- initial_reshape_school_data(df2, "ELA")


df3 <- read.csv("SchoolELAResults20062012Public_Gender.csv")
df3 <- initial_reshape_school_data(df3, "ELA")


df4 <- read.csv("SchoolELAResults20062012Public_Ethnicity.csv")
df4 <- initial_reshape_school_data(df4, "ELA")

ela.2006.2012.data <- bind_rows(df1,df2)
ela.2006.2012.data <- bind_rows(ela.2006.2012.data,df3)
ela.2006.2012.data <- bind_rows(ela.2006.2012.data,df4)



df1 <- read.csv("SchoolMathResults20062012Public_ALL.csv")
df1 <- initial_reshape_school_data(df1, "Math")


df2 <- read.csv("SchoolMathResults20062012Public_ELL.csv")
df2 <- initial_reshape_school_data(df2, "Math")


df3 <- read.csv("SchoolMathResults20062012Public_Ethnicity.csv")
df3 <- initial_reshape_school_data(df3, "Math")


df4 <- read.csv("SchoolMathResults20062012Public_Gender.csv")
df4 <- initial_reshape_school_data(df4, "Math")

math.2006.2012.data <- bind_rows(df1,df2)
math.2006.2012.data <- bind_rows(math.2006.2012.data, df3)
math.2006.2012.data <- bind_rows(math.2006.2012.data, df4)

```

```{r}
school_data.2006.2012 <- bind_rows(ela.2006.2012.data,math.2006.2012.data)

school_data <- bind_rows(school_data.2013.2015,school_data.2006.2012)
school_data <- create_borough_vector(school_data)

```

```{r}
school_data_group <- school_data %>% group_by(DBN,Year,Grade) %>%
  summarise(Level1MeanPercent = mean(Level1Percentage), 
            Level2MeanPercent = mean(Level2Percentage), 
            Level3MeanPercent = mean(Level3Percentage),
            Level4MeanPercent = mean(Level4Percentage), n = n())

school_data_group <- create_borough_vector(school_data_group)                                                                 
                                                                 
```

```{r fig.height=12,fig.width=12}
p1 <- ggplot(school_data_group, aes(y = Level1MeanPercent, x = Borough)) + 
  geom_boxplot()

p2 <- ggplot(school_data_group, aes(y = Level2MeanPercent, x = Borough)) + 
  geom_boxplot()

p3 <- ggplot(school_data_group, aes(y = Level3MeanPercent, x = Borough)) + 
  geom_boxplot()

p4 <- ggplot(school_data_group, aes(y = Level4MeanPercent, x = Borough)) + 
  geom_boxplot()

grid.arrange(p1,p2,p3,p4,ncol=2)
```    

The median value for average mean percentages are roughly equivalent for Level 
1, 2, and 3 students for all boroughs.  The median value for average mean 
percentages for Level 4 students are equivalent for Bronx, Brooklyn, and 
Manhattan, whereas the median value for average mean percentages for Level 4 
students are roughly equal for Queens and Staten Island.

```{r fig.height=12,fig.width=12}
p1 <- ggplot(school_data_group, aes(y = Level1MeanPercent, x = factor(Year))) + 
  geom_boxplot()

p2 <- ggplot(school_data_group, aes(y = Level2MeanPercent, x = factor(Year))) + 
  geom_boxplot()

p3 <- ggplot(school_data_group, aes(y = Level3MeanPercent, x = factor(Year))) + 
  geom_boxplot()

p4 <- ggplot(school_data_group, aes(y = Level4MeanPercent, x = factor(Year))) + 
  geom_boxplot()
grid.arrange(p1,p2,p3,p4,ncol=2)
```

These plots support the claim that 2009 was the best year amongst them all 
showing lower median average percentages for Level 1 and 2 students and higher 
median average percentages for Level 3 and 4 students.  Level 1 and 3 plots 
show the most drastic changes across the years.  In the Level 1 plot, the 
median values decrease over 2006-2009, then increased and remain constant from 
2010-2012 and then increases sharply and remains constant from 2013-2015.  The 
inverse trend is shown for Level 3 students.

```{r fig.height=12,fig.width=12}
p1 <- ggplot(school_data_group, aes(y = Level1MeanPercent, x = factor(Grade))) + 
  geom_boxplot()

p2 <- ggplot(school_data_group, aes(y = Level2MeanPercent, x = factor(Grade))) + 
  geom_boxplot()

p3 <- ggplot(school_data_group, aes(y = Level3MeanPercent, x = factor(Grade))) + 
  geom_boxplot()

p4 <- ggplot(school_data_group, aes(y = Level4MeanPercent, x = factor(Grade))) + 
  geom_boxplot()
grid.arrange(p1,p2,p3,p4,ncol=2)
```

The median value across grades is roughly equivalent across all grades with a 
slight lower value for grades 3-5 for Level 1 and 2 students and slightly higher
value for grades 3-5 for Level 3 and 4 students.

##Multivariate Analysis on School-Level Data from 2006-2015

After combining all the data from 2006-2015, we have over 630,000 observations. 
First we examine the Level1Percentage vs. Number.Tested with aesthetic coloring 
of the Boroughs.

```{r geom_point_plot_4, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
ggplot(school_data, aes(x = Number.Tested, y = Level1Percentage)) + 
  geom_point(aes(color = Borough))
```

Looking at the graph, I notice a large percentage of observations for the Bronx 
and Brooklyn residing between 30 and 80 percent.  These observations also seem 
to fall less than 200 students tested.  Observations for Queens and Staten 
Island seem to fall below 25 percent when the number of students range from 100 
to 500.  It is tough to analyze observations for Manhattan in this plot.  To get
a better view, we will generate a plot with only observations for Manhattan

```{r geom_point_plot_5, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
ggplot(subset(school_data, Borough == "Manhattan" ), 
       aes(x = Number.Tested, y = Level1Percentage)) + 
  geom_point(aes(color = Borough))
```


The plot for Manhattan looks roughly the same as the original: high percentages 
of Level 1 students for those tested below 200 and lower percentages for those 
tested more than 200. Let's see how the observations are distributed across 
boroughs.

```{r}
table(school_data$Borough)
```

Given the number of observations that belong to Manhattan, it seems that its 
lack of points in the original scatterplot is due to overplotting.


Let's do a facet wrap on the data based on Borough to see if this trend is 
across all boroughs.


```{r geom_point_plot_6, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
ggplot(school_data, aes(x = Number.Tested, y = Level1Percentage)) + 
  geom_point(alpha = 1/100) + facet_wrap(~Borough)
```

It seems that across all boroughs, the percentage of Level 1 students decrease 
after the number of students tested passes a specific threshold.  My suspicion 
is that the number of Level 1 students remains constant, but since the 
population size of students tested increases, they become a smaller percentage.  
Let's see if the data supports this hypothesis by comparing the Level1Count vs 
Number.Tested faceted over Boroughs

```{r geom_point_plot_7, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
ggplot(school_data, aes(x = Number.Tested, y = as.integer(Level1Count))) + 
  geom_point(alpha = 1/80) + facet_wrap(~Borough)
```

My hypothesis is somewhat true, but we can see in Brooklyn and Queens that the 
number of Level 1 students decrease as the number of students tested 
increases.  Let's see what the correlation test shows:

```{r}
cor.test(school_data$Number.Tested,as.integer(school_data$Level1Count))
```

The correlation test shows that I was somewhat true, as their is some correlation 
between Number tested and Level1 count, but it is not a strong correlation.  Let's 
see how the same plot faceted over years looks like:

```{r geom_point_plot_8, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
ggplot(school_data, aes(x = Number.Tested, y = Level1Percentage)) + 
  geom_point(alpha = 1/100) + facet_wrap(~Year)

```

The trend seems to be the same from 2006-2012 with a consistent decrease in 
Level 1 students' percentage from 2006-2009 for population sizes less than 200.
From 2013 to 2015, there are larger percentages of Level 1 students across a 
wider range of student populations.  This could be due to the change in NY 
Testing to be more Common Core aligned in 2013 as mentioned in the Notes of 
the dataset.  Let's analyze the Student Level percentages across each borough 
for each grade.  Let us analyze how students testing at various levels over 
different grade levels.  I plot the median, mean, 10th, and 90th quantile trend 
lines as well.

```{r geom_point_plot_9, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
by(school_data$Level1Percentage,school_data$Grade, summary)
ggplot(school_data, aes(x = Grade, y = Level1Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=Borough)) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  scale_color_brewer(palette = "Set1") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'yellow') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'yellow') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'pink')
```

There seems to be a higher concentration of Bronx and Manhattan schools 
with a high percentage of students who tested at level 1 across all grades 
whereas Brooklyn, Queens, and Staten Island have relatively low percentage of 
students who tested at level 1.  Looking at the 90th quantile line 
(dotted **yellow** line at the top), we can see that its lowest point was in 
4th grade and it steadlily increased up to 7th grade and then decreased in 
8th grade. The median (**pink**) and the mean (**black**) lines appear to be
fairly uniform.

```{r geom_point_plot_10, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
by(school_data$Level2Percentage,school_data$Grade, summary)
ggplot(school_data, aes(x = Grade, y = Level2Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=Borough)) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  scale_color_brewer(palette = "Set1") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'yellow') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'yellow') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'pink')

```

There is a more noticeable prescense of Staten Island schools 3rd-5th grades 
from 25% and below.  I find it interesting that there are considerable number of 
Manhattan schools at the higher percentages and lower percentages in 6th-8th 
grades.  Brooklyn and Queens schools seems to fall mostly between the 10th and 
the 90th quantiles. The median and mean lines are almost perfectly aligned which
suggests a normal distribution between the level 2 percentages across each grade.
It is also noticable how the number of students who tested at level 2 increases 
over each grade which is seen by the summary lines as well as the summary 
statistics.

```{r geom_point_plot_11, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
by(school_data$Level3Percentage,school_data$Grade, summary)
ggplot(school_data, aes(x = Grade, y = Level3Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=Borough)) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  scale_color_brewer(palette = "Set1") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'yellow') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'yellow') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'pink')
```

There is a slight decreasing trend from elementary to middle school shown.
Most of Staten Island and Queens schools fall between the 50th and 90th 
quantiles. The Bronx and Manhattan schools fall closely around the 10th quantile.
Manhattan also has a decent number of schools above the 90th quantile as well.

```{r geom_point_plot_12, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
by(school_data$Level4Percentage,school_data$Grade, summary)
ggplot(school_data, aes(x = Grade, y = Level4Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=Borough)) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  scale_color_brewer(palette = "Set1") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'yellow') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'yellow') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'pink')

```

The 90th quantile seems to peak in 4th grade and descend onwards. Staten Island, 
Queens, and Manhattan have a high concentration of schools that fall above the 
90th quantile.  Given the concentration of Manhattan schools above the 90 
quantile range, I'm surprised that Manhattan didn't have the highest median 
range across all boroughs.

```{r geom_point_plot_13, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
by(school_data$Level1Percentage,school_data$Year, summary)
ggplot(school_data, aes(x = Year, y = Level1Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=factor(Grade))) + 
  scale_x_continuous(breaks = seq(2006,2015,1)) +
  scale_color_brewer(palette = "Set2") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'red')
```

2009 has the lowest concentration of students who tested at level 1. There is a 
downward trend from 2006 - 2009.  Spikes can be seen in years 2010 and 2013 with 
largest increase occurring when the NYC became more aligned with the Common Core 
Standards. 8th graders have the higher percentages of students testing at level 
1 from 2006-2008.  6th graders were at the higher percentages in 2009, followed 
by a mix of all grades at the higher percentages from 2010 onwards.

```{r geom_point_plot_14, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
by(school_data$Level2Percentage,school_data$Year, summary)
ggplot(school_data, aes(x = Year, y = Level2Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=factor(Grade))) + 
  scale_x_continuous(breaks = seq(2006,2015,1)) +
  scale_color_brewer(palette = "Set2") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'red')
```

6th and 8th graders are largely concentrated in the higher percentages from 
2006-2012.  4th and 6th graders are at the higher percentages from 
2013-2015.  3rd, 4th and 7th graders fall between the median and the 10th 
quantile across most years.

```{r geom_point_plot_15, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
by(school_data$Level3Percentage,school_data$Year, summary)
ggplot(school_data, aes(x = Year, y = Level3Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=factor(Grade))) + 
  scale_x_continuous(breaks = seq(2006,2015,1)) +
  scale_color_brewer(palette = "Set2") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'red')
```

3rd,4th and 7th graders have majority of their students concentrated in the 
higher percentages across all years whereas 6th and 8th graders are more 
concentrated around the lower percentages.  I find it interesting that the 
students seem to struggle once transitioning into middle school and in their 
last year of middle school.  But the 7th grade students seem to be doing quite 
well.

```{r geom_point_plot_16, cache=TRUE,cache.path= 'cache/', fig.path='figure/'}
by(school_data$Level4Percentage,school_data$Year, summary)
ggplot(school_data, aes(x = Year, y = Level4Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=factor(Grade))) + 
  scale_x_continuous(breaks = seq(2006,2015,1)) +
  scale_color_brewer(palette = "Set2") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'red')
```

Trend lines show an increase from 2006-2009, decreases from 2010-2011, slight 
increase in 2012, then falls sharply in 2013. 3rd and 4th graders are 
concentrated at 25% and above in 2006 and 2007.  4th and 6th graders are at the 
higher percentages 2009-2015.


```{r, fig.width= 12}
p1 <- ggplot(school_data, aes(x = Grade, y = Level1Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=factor(Subject))) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  scale_color_brewer(palette = "Set2") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'red')

p2 <- ggplot(school_data, aes(x = Grade, y = Level2Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=factor(Subject))) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  scale_color_brewer(palette = "Set2") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'red')

p3 <- ggplot(school_data, aes(x = Grade, y = Level3Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=factor(Subject))) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  scale_color_brewer(palette = "Set2") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'red')

p4 <- ggplot(school_data, aes(x = Grade, y = Level4Percentage)) +
  geom_jitter(alpha = 1/ 7, aes(color=factor(Subject))) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  scale_color_brewer(palette = "Set2") + 
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  geom_line(stat = 'summary', fun.y = mean, color = 'black') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.9, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.1, linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, probs = 0.5, linetype = 2,
            color = 'red')

grid.arrange(p1,p2,p3,p4, ncol = 2)
```

Most of the students tested within levels 1-3 in the ELA portion of the 
test.  The Math scores are at all levels, but more students tested at levels 
3 and 4 in Math than in ELA.  It would be fair to conclude that more students 
tested well in Math than in ELA given the data.


I have created another dataset which has the average percentages across all 
levels of students using the **summarise** function.  Let's analyze average 
percentages across the various levels to see if it gives us any 
additional insight.

```{r}
ggplot(school_data_group, aes(x = Level1MeanPercent)) + 
  geom_freqpoly(aes(color = Borough)) + facet_wrap(~Year)
                                                                                          
```

```{r}
ggplot(school_data_group, aes(x = Level2MeanPercent)) + 
  geom_freqpoly(aes(color = Borough)) + facet_wrap(~Year)
                                                                                          
```

```{r}
ggplot(school_data_group, aes(x = Level3MeanPercent)) + 
  geom_freqpoly(aes(color = Borough)) + facet_wrap(~Year)
                                                                                          
```

```{r}
ggplot(school_data_group, aes(x = Level4MeanPercent)) + 
  geom_freqpoly(aes(color = Borough)) + facet_wrap(~Year)
                                                                                          
```

The first thing I notice is how the Level 1 and 4 student data is skewed and 
the Level 2 and 3 student data is fairly normalized.  The average percent of 
Level 1 students seems to be similarly distributed across all boroughs, but 
there is more distinction in the Level 2 data.  Queens and Staten Island's mean 
are before 25 percent from 2006-2009, but align with the other boroughs' 
distributions from 2010 onwards. The Bronx's normal distribution slowly shifts 
right each year up until 2013, then the mean value shifts back left and stays 
there from 2013-2015.  Manhattan's mean oscillates left from 2006-2009 then to 
the right from 2010-2012 and stabilizes from 2013-2015.

In the Level 3 Data, we can see why 2009 seems to be the best year across them 
all as there are a large count of schools that have average percent of greater 
than 50% across all boroughs.  The trend shows that 2006-2009 had high average 
percentages of Level 3 students, but that trend decreases each year afterwards.

The average percentage of Level 4 students is below 25% for all boroughs across 
all years.


```{r}
ggplot(school_data_group, aes(x = Level1MeanPercent)) + 
  geom_freqpoly(aes(color = Borough)) + facet_wrap(~Grade)
```

```{r}
ggplot(school_data_group, aes(x = Level2MeanPercent)) + 
  geom_freqpoly(aes(color = Borough)) + facet_wrap(~Grade)
```

```{r}
ggplot(school_data_group, aes(x = Level3MeanPercent)) + 
  geom_freqpoly(aes(color = Borough)) + facet_wrap(~Grade)
```


```{r}
ggplot(school_data_group, aes(x = Level4MeanPercent)) + 
  geom_freqpoly(aes(color = Borough)) + facet_wrap(~Grade)
```

3-5th graders had a larger number of schools with low percentage averages for 
Level 1 students and Level 2 students (< 50%). 3-5th graders had a high number 
of high percentage averages of Level 3 students.  The number of Level 4 students
with averages percentages greater than 25% are larger in 3rd-5th graders than 
6-8th graders.

6-8th grade students had a large number of schools with average percentages 
around 50% for Level 2 students and average percentages around 20-35% for 
Level 3 students.


#Final Plots and Summary

##Plot One
```{r, echo=FALSE}
ggplot(school_data, aes(x = factor(Year), 
                        y = as.numeric(Level3And4Percentage)/100)) + 
  geom_boxplot(aes(fill = factor(Year)))  + 
  scale_y_continuous(labels = percent) + 
  theme(legend.position = "none") + xlab("Year") + 
  ylab("Students who are proficient for their grade") + 
  ggtitle("Percentage of Proficient Students from 2006-2015")
```

##Description One
It is shown that 2009 had the highest median percentage value of proficient 
students over all the years where the IQR for 2009 falls between 63% and 89%.  
From 2006-2009 the median percentage of proficient students lies above 50% and 
falls below 50% from 2010-2011.  After the sharp decline in 2013, the median 
percentage value reaches 25% in 2015.  From 2013-2015, 75% of the schools 
have less than a 50% proficient students according to the standards.

##Plot Two
```{r, echo=FALSE}
ggplot(subset(school_data ,Category %in% 
                c("Black", "White", "Hispanic", "Asian")), 
                        aes(x = as.numeric(Level3And4Percentage)/100, 
                            y =..count../sum(..count..))) + 
  geom_freqpoly(aes(color = Category)) + 
  scale_x_continuous(labels = percent) +
  xlab("Students who are proficient for their grade") + 
  ylab("Percentage of Schools") + 
  ggtitle("Percentage of Proficient Students by Race") + 
  scale_y_continuous(labels = percent) 
```

##Description Two
The trends for Black and Hispanic students are roughly the same.  The trends 
for White and Asian students also follow the same pattern.  If we look at the 
trend lines for Black and Hispanic students vs. White and Asian Students, we 
can see the interception point occurring around the 80% proficient mark.   

##Plot Three
```{r, echo=FALSE}
ggplot(school_data, 
       aes(y = as.numeric(Level3And4Percentage)/100, x = Borough)) + 
  geom_boxplot(aes(fill = Borough))+ 
  scale_y_continuous(labels = percent) + 
  theme(legend.position = "none") + 
  ylab("Students who are proficient for their grade") + 
  ggtitle("Percentage of Proficient Students from 2006-2015")
```

##Description Three
The IQR for Manhattan falls almost exactly between 25 and 75% giving it the 
largest IQR across all boroughs.  75% of the Bronx schools have less than a 
55% proficient rate for its students.


#Reflection
Analyzing the NYC Test data gave me quite some insight about their education 
system. Given that my fiance and my 11 year old stepson reside in the Bronx, 
I had a lot of interest in finding out how well the test scores were in the 
Bronx borough.  Although I was not pleased with my findings, I'm was not 
surprised.  The Bronx is one of the most impoverished and economically 
challenged boroughs in New York City.  I ran into a roadblock when I wanted 
to try to correlate the Borough Test Data with the budget funding for each 
school to see if there was any relationship with lower test scores in lower 
funded schools.  There is no dataset provided and no API to access and retrieve 
this information.  To retrieve this information, I would have to perform some 
Screen Scraping tasks to generate this info using the way the HTML accesses this information.  To do this for tens of thousands of schools didn't seem like the 
best thing to do given the time constraint.  I also ran into a roadblock when 
I noticed that the data type for the percentages in the data from 2006-2012 
was different than the percentages in 2012-2013.  Thus I had to write separate 
functions to wrangle the datasets before combining them.  My final roadblock 
was when I discovered that the Mean Scores varied over years, thus it would 
not be a reliable metric to measure when analyzing data over the years.  This 
is why I stop analyzing it once I combined the earlier data with the 2013-2015 
dataset.  I did have success with the many ways the data was broken down 
(Gender, Race, Borough, English Learner, Grade, etc.) which allowed me to look 
at the data through different categories.  For future work, I would like to 
look at the top 10 performing schools and the bottom 10 performing schools and 
see if there is any insight that I can find as to why the top 10 schools 
performs so well and the bottom 10 are not doing so well.  This could be 
analyzed on Borough-by-borough basis or grade level basis. Also, there seem 
to be a breakdown on test scores once students reached 8th grade that would 
need some further investigation as well.  I also would like to overlay the data 
onto a google map so that we can visualize in what locations are schools doing 
well and which areas need more attention.  I attempted to do this, but found it 
difficult to find a dataset with the geospatial data for all of the 
schools.  Finally, I would like to get more insight as to why Black and Hispanic 
students are not performing as well as their White and Asian student 
counterparts.  This is very important to me as an African-American male who 
faced the same disconnect when growing up in the city of Atlanta, Georgia.
